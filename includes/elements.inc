<?php
function facebook_instant_articles_field_format_standard_element($items, $wrapper_tag = 'p', $class = '') {
  $element = array();

  if (!empty($class)) {
    $class = ' class="'. $class .'"';
  }

  foreach ($items as $delta => $item) {
    $element[0]['#markup'] = '<'. $wrapper_tag . $class .'>' . $item['safe_value'] . '</'. $wrapper_tag . '>';
  }
  return $element;
}

function facebook_instant_articles_field_format_ad_element($items, $settings) {
  $element = array();

  foreach ($items as $delta => $item) {
    $attributes = "";

    if (!empty($settings['height'])) {
      $attributes .= ' height="' . $settings['height'] . '"';
    }
    if (!empty($settings['width'])) {
      $attributes .= ' width="' . $settings['width'] . '"';
    }
    switch($settings['source']) {
      case 'embed':
        $element[0]['#markup'] = '<figure class="op-ad"><iframe ' . $attributes . '>' . $item['safe_value'] . '</iframe></figure>';
      break;
      default:
        $element[0]['#markup'] = '<figure class="op-ad"><iframe src="' . $item['safe_value'] . '"' . $attributes . ' /></figure>';
      break;
    }
  }
  return $element;
}

function facebook_instant_articles_field_format_analytics_element($items, $settings) {
  $element = array();
  foreach ($items as $delta => $item) {
    switch($settings['source']) {
      case 'embed':
        $element[0]['#markup'] = '<figure class="op-tracker"><iframe>' . $item['safe_value'] . '</iframe></figure>';
      break;
      default:
        $element[0]['#markup'] = '<figure class="op-tracker"><iframe src="' . $item['safe_value'] . '" /></figure>';
      break;
    }
  }
  return $element;
}

function facebook_instant_articles_field_format_image_element($items, $settings) {
  $element = array();

  foreach ($items as $delta => $item) {
    $image_settings = array(
      'style_name' => $settings['style'],
      'path' => $item['uri'],
    );
    $image = theme_image_style($image_settings);

    $caption = "";
    if (!empty($settings['caption'])) {
      $caption = '<figcaption>' . $item['alt'] . '</figcaption>';
    }

    $data_feedback = array();
    $data_feedback_attribute = '';
    if (!empty($settings['likes'])) {
      $data_feedback[] = 'fb:likes';
    }
    if (!empty($settings['comments'])) {
      $data_feedback[] = 'fb:comments';
    }
    if (!empty($data_feedback)) {
      $data_feedback_attribute = ' data-feedback="' . implode(',', $data_feedback) . '"';
    }

    $data_mode_fullscreen = '';
    if (!empty($settings['fullscreen'])) {
      $data_mode_fullscreen = ' data-mode="fullscreen"';
    }

    $output = '<figure' . $data_feedback_attribute . $data_mode_fullscreen . '>' . $image . $caption . '</figure>';
    $element[0]['#markup'] = $output;
  }

  return $element;
}

function facebook_instant_articles_field_format_interactive_element($items, $settings) {
  $element = array();

  foreach ($items as $delta => $item) {
    $attributes = "";

    if (!empty($settings['height'])) {
      $attributes .= ' height="' . $settings['height'] . '"';
    }
    if (!empty($settings['width'])) {
      $attributes .= ' class="' . $settings['width'] . '"';
    }

    $element[0]['#markup'] = '<figure class="op-interactive"><iframe src="' . $item['safe_value'] . '"' . $attributes . ' /></figure>';
  }
  return $element;
}

function facebook_instant_articles_field_format_list_element($items, $settings) {
  $element = array();

  if (empty($items) || count($items) == 0) {
    return $element;
  }

  $list_type = !empty($settings['list_type']) ? $settings['list_type'] : 'ol';

  $list_markup = '<' . $list_type . '>';

  foreach ($items as $delta => $item) {
     $list_markup .= '<li>' . $item['value'] . '</li>';
  }

  $list_markup .= '</' . $list_type . '>';

  $element[0]['#markup'] = $list_markup;
  return $element;
}
